\documentclass[12pt]{article}

% set margins according to Reimer's wishes
\usepackage[margin=1.0in]{geometry}

% nag if old commands or packages used
\usepackage{nag}

\usepackage{graphicx}
\usepackage{rotating}
\usepackage{float}
\usepackage{hyperref}
\usepackage{siunitx}
\usepackage{mhchem}
\usepackage{subfig}

\title{Simulation Report}
\author{
        Henry Baxter \\
                Department of Physics and Astronomy\\
        University of Victoria\\
        henry.baxter@gmail.com
}
\date{\today}


\begin{document}
\maketitle

\tableofcontents

\section{Parameters}

\subsection{X-ray source}
\begin{itemize}
	\item Tungsten target
	\item Target angle: \ang{((( simulation['target-angle'] )))}
	\item Distance from electron gun to target: \SI{((( simulation['target-distance'] )))}{\cm}
	\item Electron beam size: \SI{((( simulation['beam-height'] * 10 )))}{\mm}
	\item Incident electrons simulated (histories): ((( simulation['total-histories'] )))
	\item Target length: \SI{((( simulation['target-length'] )))}{\cm}
	\item Gap between simulated electron beams: \SI{((( simulation['beam-gap'] )))}{\cm}
\end{itemize}

\subsection{Filter}
\begin{itemize}
	((* for slab in templates['filter']['cms'][0]['slabs'] *))
	\item \SI{((( slab['zthick'] )))}{\cm} of ((( slab['medium']|medium )))
	((* endfor *))
\end{itemize}

\subsection{Collimator}
\begin{itemize}
	\item Distance from anode to exit: \SI{((( collimator_stats['length'] )))}{\cm}
	\item Number of holes: ((( collimator_stats['blocks'][0]['regions'] )))
	\item Number of interpolating BLOCK CMs: ((( collimator_stats['total_blocks'] )))
	\item Total area of holes on anode side: \SI{((( collimator_stats['anode_area'] | f)))}{\cm\squared}
	\item Total area of holes at exit: \SI{((( collimator_stats['exit_area'] | f )))}{\cm\squared}
\end{itemize}

\subsection{Visualization}
((* for shot in screenshots *))
	\subsubsection{(((shot.description)))}
	\begin{figure}[H]
	\centering
	\includegraphics[resolution=300]{(((shot.path)))}
	\caption{(((shot.description)))}
	\end{figure}
((* endfor *))

\subsection{Dosing}
\begin{itemize}
	\item Lesion diameter: \SI{((( simulation['collimator']['lesion-diameter']  )))}{\cm}
	\item Target depth: \SI{((( simulation['phantom-isocenter'][2] | abs )))}{\cm}
	\item Distance from collimator to skin: \SI{((( skin_distance )))}{\cm}
\end{itemize}

\section{Pre-Dosing Plots}
((* for plot_type, plots in grace_plots.items() *))
	\subsection{((( plot_type.replace('_', ' ').title() ))) Plots}
		((* for plot in plots *))
			\subsubsection{(((plot.name)))}
			\begin{figure}[H]
			\centering
			\includegraphics[scale=0.7,angle=270]{(((plot.path|strip_extension)))}
			\caption{(((plot.name)))}
			\label{fig:(((plot.slug)))}
			\end{figure}
		((* endfor *))
((* endfor *))

\section{Dosing Contours}

% contours['xy']
% contours['yz']

((* for plane, contours in contour_plots.items() *))
	\subsection{Doses in the (((plane.upper()))) plane}
	((* for plot in contours *))
	\begin{figure}[H]
	\centering
	\includegraphics{(((plot.path|strip_extension)))}
	\caption{(((plot.name)))}
	\end{figure}
	((* endfor *))
((* endfor *))

\section{Results}

\begin{tabular}{l l l}
	& Percent of Maximum & Absolute Dose \\
	\hline
	$D_{\mathrm{max}}$ & ((( doses.percent.max ))) & ((( doses.absolute.max ))) \\
	$D_{\mathrm{min}}$ & ((( doses.percent.min ))) & ((( doses.absolute.min ))) \\
	$D_{90}$ & ((( doses.percent.90 ))) & ((( doses.absolute.90 ))) \\
	$D_{95}$ & ((( doses.percent.95 ))) & ((( doses.absolute.95 ))) \\
	$D_{100}$ & ((( doses.percent.100 ))) & ((( doses.absolute.100 )))
\end{tabular}
\end

\subsection{Efficiency}

\begin{table}[H]
\begin{tabular}{l l l}
	& Particles & Reduction factor \\
	\hline
	Electron gun & ((( simulation['total-histories'] ))) & \\
	Photons generated & ((( photons['source'] ))) & ((( (simulation['total-histories'] / photons['source']) | f ))) \\
	Filtered X-rays & ((( photons['filter'] ))) & ((( (photons['source'] / photons['filter']) | f ))) \\
	Collimated X-rays & ((( photons['collimator'] ))) & ((( (photons['filter'] / photons['collimator']) | f )))
\end{tabular}
\end{table}

\subsection{Conformity}
\begin{table}[H]
\begin{tabular}{l l l l l}
	& Stationary & Weighted & Arc & Weighted Arc \\
	\hline
	CI & ((( ci['stationary']|f ))) & ((( ci['stationary-weighted']|f ))) & ((( ci['arc']|f ))) & ((( ci['arc-weighted']|f ))) \\
	Skin-to-Target & ((( ts['stationary']|f ))) & ((( ts['stationary-weighted']|f ))) & ((( ts['arc']|f ))) & ((( ts['arc-weighted']|f )))
\end{tabular}
\end{table}


\end{document}

